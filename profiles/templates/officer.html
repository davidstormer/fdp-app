{% extends "common/fdp_base_site.html" %}
{% load i18n admin_urls static compress profiles_extras %}
{% block bodyclass %}profile officer fdpbody{% endblock %}

{% block extrahead %}
    {{ block.super }}
    {% compress js %}
    <script src="{% static 'profiles/js/officerprofile.js' %}"></script>
    {% endcompress %}
{% endblock %}

{% block extrastyle %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick-theme.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.css">
    {% compress css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/responsive_grid.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/collapsible.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'profiles/css/profile.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'profiles/css/officer.css' %}">
    {% endcompress %}
{% endblock %}

{% if not is_popup %}
{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'profiles:index' %}">{% translate 'Searches' %}</a>
    &rsaquo;
    <a href="{% url 'profiles:officer_search' %}">{% translate 'Officer Search' %}</a>
    &rsaquo;
    <a href="{{ search_results_url }}">{% translate 'Officer Search Results' %}</a>
    &rsaquo;
    {{ title }}
</div>
{% endblock %}
{% endif %}

{% block content_title %} {% endblock %}

{% block content %}




    <h1>{{ object.name }} </h1>

    <section class="identification">
        <div class="section-heading">
            <h2>Identification</h2>
            {% if is_admin %}
            <span class="admin-actions">
                <a href="{{ object.get_edit_url }}?next={{ request.path }}"> <i class="fas fa-edit" aria-hidden="true" title="edit"></i> <span class="sr-only">edit</span></a>
            </span>
            {% endif %}
        </div>
        <div class="gridrow gridgroup">
            <div class="gridcol gridcell_1_of_3">

                <div class="slider photos">
                    {% for officer_photo in object.officer_photos %}
                    <div>
                        <img src="{{ officer_photo.photo.url }}" alt="{{ object.name }}" title="{{ object.name }}" />
                    </div>
                    {% empty %}
                    <div>
                        <img src="{% static 'img/officer_big.png' %}" alt="{% translate 'No photo available' %}" title="{% translate 'No photo available' %}" />
                    </div>
                {% endfor %}
                </div>

            </div> <!-- div.gridcol.gridcell_1_of_3 -->
            <div class="gridcol gridcell_1_of_3">
                <h3>Basic information</h3>
                {% if object.officer_aliases %}
                <p>
                    <span class="label">{% translate 'Aliases' %}:</span>
                    <span>{% for alias in object.officer_aliases %}{{ alias.name }}{% if not forloop.last %},{% endif %} {% endfor %}</span>
                </p>
                {% endif %}
                {% if object.age %}
                <p>
                    <span class="label">{% translate 'Age' %}:</span> <span>{{ object.age }}</span>
                </p>
                {% endif %}
                {% if object.officer_traits %}
                <p>
                    <span class="label">{% translate 'Traits' %}:</span>
                    <span>{% for trait in object.officer_traits %}{{ trait.name }}{% if not forloop.last %},{% endif %} {% endfor %}</span>
                </p>
                {% endif %}

                {% if object.officer_title %}
                <h3>{% if object.officer_titles %}{% translate 'Ranks' %}{% else %}{% translate 'Rank' %}{% endif %}</h3>
                <ul>
                <li>
                    <span>{{ object.officer_title.title.name }}</span>
                    {% if object.officer_title.as_of_bounding_dates %}{{ object.officer_title.as_of_bounding_dates }}{% endif %}
                </li>

                {% for title in object.officer_titles %}
                <li>
                    <span>{{ title.title.name }}</span>
                    {% if title.as_of_bounding_dates %}{{ title.as_of_bounding_dates }}{% endif %}
                </li>
                {% endfor %}
                </ul>
                {% endif %}

            </div> <!-- div.gridcol.gridcell_1_of_3 -->
            <div class="gridcol gridcell_1_of_3">
                {% if object.officer_identifiers %}
                <h3>Identifiers</h3>
                <ul class="identifiers">
                {% for identifier in object.officer_identifiers %}
                <li>
                    <span>{{ identifier.identifier }}</span>
                    <span>{% if identifier.as_of_bounding_dates %}{{ identifier.as_of_bounding_dates }}{% endif %}</span>
                    <span>({{ identifier.person_identifier_type }})</span>
                </li>
                {% endfor %}
                </ul>
                {% endif %}

                {% if object.officer_command %}
                <h3>{% if object.officer_commands %}{% translate 'Commands' %}{% else %}{% translate 'Command' %}{% endif %}</h3>
                <ul>
                    <li>
                    <span>{{ object.officer_command.grouping.name }}</span>
                    {% if object.officer_command.as_of_bounding_dates %}{{ object.officer_command.as_of_bounding_dates }}{% endif %}
                    </li>
                {% for command in object.officer_commands %}
                <li>
                    <span>{{ command.grouping.name }}</span>
                    {% if command.as_of_bounding_dates %}{{ command.as_of_bounding_dates }}{% endif %}
                </li>
                {% endfor %}
                {% endif %}

            </div> <!-- div.gridcol.gridcell_1_of_3 -->
        </div> <!-- div.gridrow.gridgroup -->
    </section> <!-- section.identification -->

    <section class="payroll">
        <div class="section-heading">
            <h2>{% translate 'Payroll' %}</h2>
            {% if is_admin %}
            <span class="admin-actions">
                <a href="{{ object.get_edit_url }}?next={{ request.path }}"> <i class="fas fa-edit" aria-hidden="true" title="edit"></i> <span class="sr-only">edit</span></a>
            </span>
            {% endif %}
        </div>
        {% if object.officer_payments %}
            <table>
                <thead>
                    <th>{% translate 'Period' %}</th>
                    <th>{% translate 'Salary' %}</th>
                    <th>{% translate 'Hours' %}</th>
                    <th>{% translate 'Gross Pay' %}</th>
                    <th>{% translate 'Overtime Hours' %}</th>
                    <th>{% translate 'Overtime Pay' %}</th>
                    <th>{% translate 'Other Pay' %}</th>
                    <th>{% translate 'County' %}</th>
                    <th>{% translate 'Leave Status' %}</th>
                </thead>
                <tbody>
                {% for officer_payment in object.officer_payments %}
                    <tr>
                        <td>{{ officer_payment.at_least_since_bounding_dates|capfirst }}</td>
                        <td>{% translate '$' %}{{ officer_payment.base_salary }}</td>
                        <td>{{ officer_payment.regular_hours }}</td>
                        <td>{% translate '$' %}{{ officer_payment.regular_gross_pay }}</td>
                        <td>{{ officer_payment.overtime_hours }}</td>
                        <td>{% translate '$' %}{{ officer_payment.overtime_pay }}</td>
                        <td>{% translate '$' %}{{ officer_payment.total_other_pay }}</td>
                        <td>{{ officer_payment.county }}</td>
                        <td>{{ officer_payment.leave_status }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="nodata">{% translate 'No payroll is recorded for this officer.' %}</p>
        {% endif %}
    </section> <!-- section.payroll -->
    <section class="associates">
        <div class="section-heading">
            <h2>{% translate 'Associates' %}</h2>
            {% if is_admin %}
            <span class="admin-actions">
                <a href="{{ object.get_edit_url }}?next={{ request.path }}"> <i class="fas fa-edit" aria-hidden="true" title="edit"></i> <span class="sr-only">edit</span></a>
            </span>
            {% endif %}
        </div>
        {% if object.officer_relationships %}
            <ul class="rel">
                {% for officer_relationship in object.officer_relationships %}
                <li class="rel">
                    <span class="othper">{{ officer_relationship.person }}</span>
                    -
                    <span class="rel">
                        {{ officer_relationship.relationship }}
                        {% if officer_relationship.num > 1 %}
                            {{ officer_relationship.num }} {% translate 'times' %}
                        {% endif %}
                    </span>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="nodata">{% translate 'No associates are recorded for this officer.' %}</p>
        {% endif %}
    </section> <!-- section.associates -->
    <section class="snapshot">
        <div class="section-heading">
            <h2>{% translate 'Snapshot' %}</h2>
            {% if is_admin %}
            <span class="admin-actions">
                <i class="fas fa-lock primary-color" aria-hidden="true" title="System generated. Cannot be edited directly."></i> <span class="sr-only">System generated. Cannot be edited directly.</span>
            </span>
            {% endif %}
        </div>
        <div class="gridrow gridgroup">
            <div class="gridcol gridcell_1_of_3">

                {% if object.snapshot_dict_keys and object.snapshot_dict_keys|length > 0 %}
                {% for c in object.snapshot_dict_keys.0 %}
                <div class="snap">
                    {% with snapshot_dict=object.officer_snapshot_dict|get_value:c %}
                        {% with identifiers=snapshot_dict|get_value:identifiers_key num_cases=snapshot_dict|get_value:num_cases_key settlement_amount_total=snapshot_dict|get_value:settlement_amount_total_key %}
                    <label class="snap">{{ c }}{% if num_cases and num_cases > 1 %} x {{ num_cases }}{% endif %}</label>
                    {% for i in identifiers %}{{ i }}{% if not forloop.last %}, {% endif %}{% empty %}{% translate 'Unnamed' %}{% endfor %}
                    {% if settlement_amount_total and settlement_amount_total > 0 %}<strong>{% translate '$' %}{{ settlement_amount_total }}</strong>{% endif %}
                        {% endwith %}
                    {% endwith %}
                </div>
                {% endfor %}
                {% endif %}
            </div> <!-- div.gridcol.gridcell_1_of_3 -->
            <div class="gridcol gridcell_1_of_3">

                {% if object.snapshot_dict_keys and object.snapshot_dict_keys|length > 1 %}
                {% for c in object.snapshot_dict_keys.1 %}
                <div class="snap">
                    {% with snapshot_dict=object.officer_snapshot_dict|get_value:c %}
                        {% with identifiers=snapshot_dict|get_value:identifiers_key num_cases=snapshot_dict|get_value:num_cases_key settlement_amount_total=snapshot_dict|get_value:settlement_amount_total_key %}
                    <label class="snap">{{ c }}{% if num_cases and num_cases > 0 %} x {{ num_cases }}{% endif %}</label>
                    {% for i in identifiers %}{{ i }}{% if not forloop.last %}, {% endif %}{% empty %}{% translate 'Unnamed' %}{% endfor %}
                    {% if settlement_amount_total and settlement_amount_total > 0 %}<strong>{% translate '$' %}{{ settlement_amount_total }}</strong>{% endif %}
                        {% endwith %}
                    {% endwith %}
                </div>
                {% endfor %}
                {% endif %}

            </div> <!-- div.gridcol.gridcell_1_of_3 -->
            <div class="gridcol gridcell_1_of_3">
                {% if object.snapshot_dict_keys and object.snapshot_dict_keys|length > 2 %}
                {% for c in object.snapshot_dict_keys.2 %}
                <div class="snap">
                    {% with snapshot_dict=object.officer_snapshot_dict|get_value:c %}
                        {% with identifiers=snapshot_dict|get_value:identifiers_key num_cases=snapshot_dict|get_value:num_cases_key settlement_amount_total=snapshot_dict|get_value:settlement_amount_total_key %}
                    <label class="snap">{{ c }}{% if num_cases and num_cases > 0 %} x {{ num_cases }}{% endif %}</label>
                    {% for i in identifiers %}{{ i }}{% if not forloop.last %}, {% endif %}{% empty %}{% translate 'Unnamed' %}{% endfor %}
                    {% if settlement_amount_total and settlement_amount_total > 0 %}<strong>{% translate '$' %}{{ settlement_amount_total }}</strong>{% endif %}
                        {% endwith %}
                    {% endwith %}
                </div>
                {% endfor %}
                {% endif %}

            </div> <!-- div.gridcol.gridcell_1_of_3 -->
        </div> <!-- div.gridrow.gridgroup -->
    </section> <!-- section.snapshot -->

    <section class="misconduct">

        <div class="section-heading">
            <h2>Misconduct</h2>
            &nbsp;
            <span class="admin-actions">
                {% if has_attachments %}
                <a href="{% url 'profiles:officer_download_all_files' object.pk %}"><span class="h2wrap">
                    <span class="h2lower"><i class="fas fa-file-archive"></i></span>
                    <span class="h2upper">{% translate 'Download all attachments' %}</span>
                </span></a>
                {% endif %}
            </span>
        </div>

        <span id="i_expandall">
            <span>{% translate 'Expand' %}</span>
            <span>{% translate 'All' %}</span>
        </span>
        |
        <span id="i_collapseall">
            <span>{% translate 'Collapse' %}</span>
            <span>{% translate 'All' %}</span>
        </span>

        {% if object.officer_misconducts or object.officer_contents %}
        {% for officer_misconduct in object.officer_misconducts %}
        <div class="mispad">
                <h3>
                    <button type="button" class="collapsible expanded">{% if not officer_misconduct.incident.exact_bounding_dates %}{% translate 'On an unknown date' %}{% else %}{{ officer_misconduct.incident.exact_bounding_dates|capfirst }}{% endif %}
                    {% if is_admin %}
                    &nbsp;
                    <span class="admin-actions">
                        <a href="{{ officer_misconduct.incident.get_edit_url }}?next={{ request.path }}"> <i class="fas fa-edit" aria-hidden="true" title="edit"></i> <span class="sr-only">edit</span></a>
                    </span>
                    {% endif %}
                    </button>
                </h3>
            <div class="collapsible">
                <div class="gridrow gridgroup">
                    <div class="gridcol gridcell_1_of_2">
                        {% if officer_misconduct.incident.description %}<span class="mish1">{% translate 'Incident Summary' %}</span>{% endif %}
                        {% if officer_misconduct.is_guess %}
                        <p class="warning">{% translate 'WARNING: A DIFFERENT OFFICER MAY BE INVOLVED' %}</p>
                        {% endif %}
                        <p class="missummary">{{ officer_misconduct.incident.description }}</p>
                        {% if officer_misconduct.incident.officer_incident_tags %}
                        <p class="mistags">
                            {% for tag in officer_misconduct.incident.officer_incident_tags %}
                                {% translate '#' %}{{ tag.name|title|cut:' ' }}{% if not forloop.last %},{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}
                        {% if officer_misconduct.incident.officer_other_persons %}
                        <span class="mish1">{% translate 'Other Officers Involved' %}</span>
                        <p class="mispeoples">
                            {% for other_person in officer_misconduct.incident.officer_other_persons %}
                                <a href="{% url 'profiles:officer' pk=other_person.person.pk %}">{{ other_person.person.name }}</a>{% if not forloop.last %},{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}
                    </div> <!-- div.gridcol.gridcell_1_of_2 -->
                    <div class="gridcol gridcell_1_of_2">
                        {% if officer_misconduct.parsed_officer_content_person_allegations %}
                        <span class="mish1">{% translate 'Allegations' %}</span>
                        <ul class="misall">
                        {% for allegation, outcomes in officer_misconduct.parsed_officer_content_person_allegations.items %}
                            <li class="misall">
                                <span class="mish2">{{ allegation }}</span>
                                {% for outcome in outcomes %}{{ outcome }}{% if not forloop.last %},{% endif %}{% endfor %}
                            </li>
                        {% endfor %}
                        </ul>
                        {% endif %}

                        {% if officer_misconduct.parsed_officer_content_person_penalties %}
                        <span class="mish1">{% translate 'Penalties' %}</span>
                        <ul class="misall">
                        {% for penalty in officer_misconduct.parsed_officer_content_person_penalties %}
                            <li class="misall"><span class="mish2">{{ penalty }}</span></li>
                        {% endfor %}
                        </ul>
                        {% endif %}

                        {% if officer_misconduct.parsed_officer_content_types and officer_misconduct.parsed_officer_contents %}
                        <span class="mish1">{% translate 'Sources' %}</span>
                        <ul class="misall">
                        {% for content in officer_misconduct.incident.officer_contents %}
                            <li class="misall">
                                {{ content.type.name|default:"Other" }}
                                {{ content.officer_content_identifiers|format_identifiers }}
                                {{ content.link }}
                                {% if is_admin %}
                                    <a href="{{ content.get_edit_url }}?next={{ request.path }}"> <i class="fas fa-edit" aria-hidden="true" title="edit"></i> <span class="sr-only">edit</span></a>
                                {% endif %}
                                {% if content.officer_attachments %}
                                    <ul class="misall">
                                    {% for attachment in content.officer_attachments %}
                                        <li class="misall">
                                            {% if attachment.file %}
                                            <a class="misatt" href="{{ attachment.file.url }}" rel="noopener noreferrer" target="_blank" download><i class="fas fa-file-download"></i>
                                            {% elif attachment.link %}
                                            <a class="misatt" href="{{ attachment.link }}"><i class="fas fa-link"></i>
                                            {% endif %}
                                            {{ attachment.name }}{% if attachment.file or attachment.link %}</a>{% endif %}
                                        </li>
                                    {% endfor %}
                                    </ul>
                                {% endif %}
                            </li>
                        {% endfor %}

                        </ul>
                        {% endif %}
                    </div> <!-- div.gridcol.gridcell_1_of_2 -->
                </div> <!-- div.gridrow.gridgroup -->
            </div> <!-- div.collapsible -->
        </div> <!-- div.mispad -->
        {% endfor %}

        {% for content_person in object.officer_contents %}
        {% with content=content_person.content %}
        <div class="mispad">
            <h3>
                <button type="button" class="collapsible expanded">
                {% if content.type %}{{ content.type }}{% endif %}
                {% for content_identifier in content.officer_content_identifiers %}
                    {{ content_identifier.identifier }}{% if not forloop.last %},{% endif %}
                {% empty %}
                    {% translate 'Unnamed' %}
                {% endfor %}
                {% if is_admin %}
                &nbsp;
                <span class="admin-actions">
                    <a href="{{ content.get_edit_url }}?next={{ request.path }}"> <i class="fas fa-edit" aria-hidden="true" title="edit"></i> <span class="sr-only">edit</span></a>
                </span>
                {% endif %}

                </button>
            </h3>
            <div class="collapsible">
                <div class="gridrow gridgroup">
                    <div class="gridcol gridcell_1_of_2">
                        <span class="mish1">
                            {% if content.type %}{{ content.type }}{% endif %}
                            {% for content_identifier in content.officer_content_identifiers %}
                                {{ content_identifier.identifier }}{% if not forloop.last %},{% endif %}
                            {% endfor %}
                        </span>
                        <p class="missummary">
                            {% if content.description %}{{ content.description }}{% else %}{% translate 'There is no summary available for this content.' %}{% endif %}</p>
                        {% if content_person.content.officer_other_persons %}
                        <span class="mish1">{% translate 'Other Officers Involved' %}</span>
                        <p class="mispeoples">
                            {% for other_person in content.officer_other_persons %}
                                <a href="{% url 'profiles:officer' pk=other_person.person.pk %}">{{ other_person.person.name }}</a>{% if not forloop.last %},{% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}

                        {% if content_person.parsed_officer_content_person_allegations %}
                        <span class="mish1">{% translate 'Allegations' %}</span>
                        <ul class="misall">
                        {% for allegation, outcomes in content_person.parsed_officer_content_person_allegations.items %}
                            <li class="misall">
                                <span class="mish2">{{ allegation }}</span>
                                {% for outcome in outcomes %}{{ outcome }}{% if not forloop.last %},{% endif %}{% endfor %}
                            </li>
                        {% endfor %}
                        </ul>
                        {% endif %}

                        {% if content_person.parsed_officer_content_person_penalties %}
                        <span class="mish1">{% translate 'Penalties' %}</span>
                        <ul class="misall">
                        {% for penalty in content_person.parsed_officer_content_person_penalties %}
                            <li class="misall"><span class="mish2">{{ penalty }}</span></li>
                        {% endfor %}
                        </ul>
                        {% endif %}
                    </div> <!-- div.gridcol.gridcell_1_of_2 -->
                    <div class="gridcol gridcell_1_of_2">
                        {% if content.content_case %}
                        {% with content_case=content.content_case %}
                        {% if content_case.outcome or content_case.settlement_amount %}
                        <span class="mish1">{% translate 'Outcome' %}</span>
                        <p>
                            {% if content_case.outcome %}{{ content_case.outcome }}{% endif %}
                            {% if content_case.settlement_amount %}{% translate '$' %}{{ content_case.settlement_amount }}{% endif %}
                        </p>
                        {% endif %}
                        {% endwith %}
                        {% endif %}
                        {% if content.name or content.link %}
                        {% if content.name %}<p><span class="mish1inline">{% translate 'Name' %}</span>: {{ content.name }}</p>{% endif %}
                        {% if content.link %}<p><span class="mish1inline">{% translate 'Link' %}</span>: <a class="misatt" href="{{ content.link }}">{{ content.link }}</a></p>{% endif %}
                        {% endif %}
                        {% if content.officer_attachments %}
                        <span class="mish1">{% translate 'Files' %}</span>
                        <ul class="misall">
                        {% for attachment in content.officer_attachments %}
                            <li class="misall">
                                {% if attachment.file %}
                                <a class="misatt" href="{{ attachment.file.url }}" rel="noopener noreferrer" target="_blank" download><i class="fas fa-file-download"></i>
                                {% elif attachment.link %}
                                <a class="misatt" href="{{ attachment.link }}"><i class="fas fa-link"></i>
                                {% endif %}
                                {{ attachment.name }}{% if attachment.file or attachment.link %}</a>{% endif %}
                            </li>
                        {% endfor %}
                        </ul>
                        {% endif %}
                    </div> <!-- div.gridcol.gridcell_1_of_2 -->
                </div> <!-- div.gridrow.gridgroup -->
            </div> <!-- div.collapsible -->
        </div> <!-- div.mispad -->
        {% endwith %}
        {% endfor %}

        {% else %}
            <p class="nodata">{% translate 'No misconduct is recorded for this officer.' %}</p>
        {% endif %}
    </section> <!-- section.misconduct -->

{% endblock %}


{% block endscript %}
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.js"></script>
    {{ block.super }}
{% endblock %}

{% block onready %}
    {{ block.super }}
    Fdp.OfficerProfile.init();
{% endblock %}
